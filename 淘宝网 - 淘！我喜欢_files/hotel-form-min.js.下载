/*! Generated by Clam: ntrip */
KISSY.add("ntrip/mods/hotel/hotel-form",["dom","node","event","base","../common/trip-form","../common/trip-common"],function(a,b){var c=b("dom"),d=b("node"),e=(b("event"),b("base")),f=b("../common/trip-form"),g=b("../common/trip-common"),h=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,i={inCityNull:"\u8bf7\u9009\u62e9\u76ee\u7684\u57ce\u5e02",inTime:"\u8bf7\u9009\u62e9\u5165\u4f4f\u65e5\u671f",inTimeFormat:"\u5165\u4f4f\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",outTime:"\u8bf7\u9009\u62e9\u79bb\u5e97\u65e5\u671f",outTimeFormat:"\u79bb\u5e97\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",outLaterIn:"\u5165\u4f4f\u65e5\u671f\u4e0d\u80fd\u665a\u4e8e\u79bb\u5e97\u65e5\u671f\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",toLong:"\u9152\u5e97\u9884\u8ba2\u65f6\u95f4\u4e0d\u80fd\u8d85\u8fc728\u5929\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",autoCompleteNull:'\u5bf9\u4e0d\u8d77\uff0c\u6ca1\u6709\u627e\u5230<span class="conve-error">"{userInput}"</span>'},j={query:"//hotel.alitrip.com/ajax/suggest/CitySuggestion.do?t=0&q={query}&_input_charset=utf-8",overQuery:"//hotel.alitrip.com/ajax/suggest/CitySuggestion.do?t=1&q={query}&_input_charset=utf-8",cnHot:"//www.alitrip.com/go/rgn/trip/jsonp/hotel.php",overseaHot:"//www.alitrip.com/go/rgn/trip/hotoverseav2_jsonp.php"},k=e.extend({initializer:function(){var a=this;a.formNode=d.one("#J_hotel_form"),a.type=d.all("#J_hotelType input"),a.inCity=d.one("#J_hotelInCity"),a.inTime=d.one("#J_hotelInTime"),a.outTime=d.one("#J_outTime"),a.hotelType=d.all("#J_hotelType input"),a.inCityCode=d.one("#J_OmniCode"),a._init(),a._bindUI()},_init:function(){var b=this,c=g.toStringDate(g.getNextDays(0)),e=g.toStringDate(g.getNextDays(2));b.formObj=new f({id:"#J_hotel_form",calendar:[{id:"hotelCalendar",triggerNode:b.inTime,finalTriggerNode:b.outTime,minDate:new Date,startDate:c,endDate:e,afterDays:89,isDateIcon:!0,isHoliday:!0,isDateInfo:!1}],autoComplete:[{inputNode:"#J_hotelInCity",hotSource:j.cnHot,source:j.query,resultListLocator:"result",wrapperClass:"conve-complete J_convePop",resultTextLocator:function(a){var b=a.t;return b=b?b.split("_")[0]:""},width:b.inCity.parent(".conve-input").outerWidth(),align:{node:b.inCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}}]}),b.inCityAutoComplete=b.formObj.getAutoCompleteById("#J_hotelInCity"),b.inTime.val(c),b.outTime.val(e),b.calendar=b.formObj.getCalendarById("hotelCalendar"),a.each(b.hotelType,function(a){var c=d.one(a);c.attr("checked")&&(b.typeVal=c.val(),b.changeType())})},_bindUI:function(){var a=this,b=a.inCityCode;a.formNode.on("submit",a.submitForm,a),a.type.on("click",a.changeType,a),b&&(a.inCityAutoComplete.get("inputNode").on("change",function(){""==d.one(this).val()&&b.val("")}),a.inCityAutoComplete.on("select",function(a){b.val(a.result.raw.c)}))},submitForm:function(){var a=this;a._validate()&&(a.formObj.storeFormInfo(),a.formNode.getDOMNode().submit())},changeType:function(a){var b=this;a&&(c.val(b.inCity,""),b.typeVal=d.one(a.currentTarget).val()),0==b.typeVal?(b.inCityAutoComplete.set("hotSource",j.cnHot),b.inCityAutoComplete.set("source",j.query)):(b.inCityAutoComplete.set("hotSource",j.overseaHot),b.inCityAutoComplete.set("source",j.overQuery))},_validate:function(){var b=this;if(!g.checkNull(b.inCity))return b.inCityAutoComplete.showMessage(i.inCityNull),!1;if(!g.checkNull(b.inTime))return b.calendar.set("message",i.inTime),b.calendar.showMessage(),!1;if(!g.checkFormat(b.inTime,h))return b.calendar.set("message",i.inTimeFormat),b.calendar.showMessage(),!1;if(!g.checkNull(b.outTime))return b.calendar.set("message",i.outTime),b.calendar.showMessage(),!1;if(!g.checkFormat(b.outTime,h))return b.calendar.set("message",i.outTimeFormat),b.calendar.showMessage(),!1;var c=a.trim(b.inTime.val()),d=a.trim(b.outTime.val());return g.getDays(d,c)>=0?(b.outTime.getDOMNode().focus(),b.calendar.set("message",i.outLaterIn),b.calendar.showMessage(),!1):g.getDays(c,d)>28?(b.outTime.getDOMNode().focus(),b.calendar.set("message",i.toLong),b.calendar.showMessage(),!1):!0}});return k});