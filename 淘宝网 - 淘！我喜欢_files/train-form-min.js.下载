/*! Generated by Clam: ntrip */
KISSY.add("ntrip/mods/train/train-form",["node","event","base","../common/trip-form","../common/trip-common"],function(a,b){var c=b("node"),d=(b("event"),b("base")),e=b("../common/trip-form"),f=b("../common/trip-common"),g=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,h={depCityNull:"\u8bf7\u9009\u62e9\u51fa\u53d1\u8f66\u7ad9",arrCityNull:"\u8bf7\u9009\u62e9\u5230\u8fbe\u8f66\u7ad9",sameCity:"\u51fa\u53d1\u57ce\u5e02\u548c\u5230\u8fbe\u8f66\u7ad9\u4e0d\u80fd\u76f8\u540c",earlyThanToday:"\u51fa\u53d1\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u4eca\u5929",depTime:"\u8bf7\u9009\u62e9\u51fa\u53d1\u65e5\u671f",depTimeFormat:"\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",toLong:"\u53ea\u80fd\u9884\u8ba220\u5929\u5185\u7684\u706b\u8f66\u7968\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9",autoCompleteNull:'\u5bf9\u4e0d\u8d77\uff0c\u6ca1\u6709\u627e\u5230<span class="conve-error">"{userInput}"</span>'},i=d.extend({initializer:function(){var a=this;a.formNode=c.one("#J_train_form"),a.depCity=c.one("#J_trainDepCity"),a.arrCity=c.one("#J_trainArrCity"),a.depTime=c.one("#J_trainDepTime"),a._init(),a._bindUI()},_init:function(){var b=this;b.formObj=new e({id:"#J_train_form",calendar:[{id:"trainCalendar",triggerNode:b.depTime,finalTriggerNode:b.depTime,minDate:new Date,afterDays:69,isDateIcon:!0,isHoliday:!0,isDateInfo:!1}],autoComplete:[{inputNode:"#J_trainDepCity",hotSource:"//www.alitrip.com/go/rgn/tb-fp/2014/train-hotcity.php",source:"//train.alitrip.com/station_suggestion.htm?lines=10&q={query}&_input_charset=utf-8",resultListLocator:"results",resultTextLocator:"stationName",wrapperClass:"conve-complete J_convePop",width:b.depCity.parent(".conve-input").outerWidth(),align:{node:b.depCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}},{inputNode:"#J_trainArrCity",hotSource:"//www.alitrip.com/go/rgn/tb-fp/2014/train-hotcity.php",source:"//train.alitrip.com/station_suggestion.htm?lines=10&q={query}&_input_charset=utf-8",resultListLocator:"results",resultTextLocator:"stationName",wrapperClass:"conve-complete J_convePop",width:b.arrCity.parent(".conve-input").outerWidth(),align:{node:b.arrCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}}]}),b.depCityAutoComplete=b.formObj.getAutoCompleteById("#J_trainDepCity"),b.arrCityAutoComplete=b.formObj.getAutoCompleteById("#J_trainArrCity"),b.calendar=b.formObj.getCalendarById("trainCalendar")},_bindUI:function(){var a=this;a.formNode.on("submit",a.submitForm,a)},submitForm:function(){var a=this;a._validate()&&(a.formObj.storeFormInfo(),a.formNode.getDOMNode().submit())},_validate:function(){var b=this,c=(new Date).setHours(0,0,0,0);if(!f.checkNull(b.depCity))return b.depCityAutoComplete.showMessage(h.depCityNull),!1;if(!f.checkNull(b.arrCity))return b.arrCityAutoComplete.showMessage(h.arrCityNull),!1;if(!f.isDiff(b.depCity,b.arrCity))return b.arrCityAutoComplete.showMessage(h.sameCity),!1;if(!f.checkNull(b.depTime))return b.calendar.set("message",h.depTime),b.calendar.showMessage(),!1;if(!f.checkFormat(b.depTime,g))return b.calendar.set("message",h.depTimeFormat),b.calendar.showMessage(),!1;var d=a.trim(b.depTime.val());if(f.parseDate(d)<c)return b.depTime.getDOMNode().focus(),b.calendar.set("message",h.earlyThanToday),b.calendar.showMessage(),!1;var e=a.trim(b.depTime.val()),i=a.trim(c);return f.getDays(e,i)>20?(b.outTime.getDOMNode().focus(),b.calendar.set("message",h.toLong),b.calendar.showMessage(),!1):!0}});return i});