KISSY.add("tbr/control/phone/number",["tbr/comp/numberTextInput2","tbr/comp/textInputTip","tbr/comp/textInputMenu","tbr/history/phoneNumber","tbr/utils/numberUtils","tbr/utils/keycode","tbr/utils/monitor","util","base","dom","node"],function(e,t,n,i){function r(t){var n=this;r.superclass.constructor.apply(this,arguments);try{this._inputNode=m.one("#tbr-phone-number input"),this._appendTo=this._inputNode.parent(".conve-box").getDOMNode(),this._iconNode=m.all(this._appendTo).one(".conve-icon"),this.set("logNode",m.one(b.create('<div id="tbr-phone-number-log" aria-labelledby="tbr-phone-number-label" class="tbr-log" role="log" aria-live="assertive" aria-relevant="all" aria-atomic="true" style="position: absolute; left: 1000px; top: 0;"></div>'))),this.get("logNode").insertAfter(this._inputNode)}catch(i){console.log("\u521d\u59cb\u5316\u5931\u8d25")}this._accept=e.namespace("tbr.phone.number",e).accept,!e.isNumber(this._accept)||this._accept==f.FIXED&&this._accept==f.TEL||(this._accept=1*this._inputNode.attr("data-accept")),!e.isNumber(this._accept)||this._accept==f.FIXED&&this._accept==f.TEL||(this._accept=f.UNKNOWN),this._numberInput=new o(this._inputNode,t),m.one("body").delegate("mousedown",".tbr-numberinfo .tbr-success",function(e){n._inputNode.getDOMNode().focus(),e.halt()}),this.menu=new s(this._inputNode,{"inputContainer":".conve-input"}),this._tip=new a(this._inputNode,{"inputContainer":".conve-input","appendTo":this._appendTo}),this._showHistory=!1,this._lastValidNumber="",this._inputNode.attr({"role":"combobox","aria-owns":this.menu.get("id"),"aria-haspopup":"true"}),this._tip.on("show",function(e){n.get("logNode").html(e.node.text())}),this._numberInput.on("focus",function(){var t=this;e.log("[phone-number]input focuses"),n._lastInputValue=this.getValue(),!n._showHistory&&n.menu.isHidden()&&(""==this.getValue()?l.get(function(t,i){t.length>0?(n.menu.set("itemTemplate",g),e.each(t,function(e){e.value=e.number}),n.menu.show(t),n.set("menuName","\u5145\u503c\u5386\u53f2\u53f7\u7801\u83dc\u5355"),n.get("logNode").html(n.set("menuName")+"\u5c55\u5f00\u4e86\uff0c\u6309\u4e0a\u4e0b\u65b9\u5411\u952e\u8fdb\u884c\u5207\u6362\u9009\u9879\uff0c\u6309ENTER\u952e\u9009\u62e9\uff0c\u6309ESC\u952e\u6536\u8d77\u83dc\u5355"),n.menu.getMenuNode().one("ul").addClass("tbr-history"),i&&"cloud"==i&&n.menu.getMenuNode().one("ul").addClass("tbr-history-cloud"),n.bindDeleteNum()):n.menu.hide()}):(n.menu.set("itemTemplate",v),l.get(function(e,i){e=n._filter(t.getValue(),e),n.menu.show(e),n.set("menuName","\u8054\u60f3\u53f7\u7801\u83dc\u5355"),n.get("logNode").html(n.set("menuName")+"\u5c55\u5f00\u4e86\uff0c\u6309\u4e0a\u4e0b\u65b9\u5411\u952e\u8fdb\u884c\u5207\u6362\u9009\u9879\uff0c\u6309ENTER\u952e\u9009\u62e9\uff0c\u6309ESC\u952e\u6536\u8d77\u83dc\u5355"),n.menu.getMenuNode().one("ul").removeClass("tbr-history"),i&&"cloud"==i&&n.menu.getMenuNode().one("ul").removeClass("tbr-history-cloud")})))}).on("blur",function(){e.log("[phone-number]input blurs, hide popups"),n.menu.isHidden()||(e.log("[phone-number]menu is visible, hide it"),n.menu.hide(),n.get("logNode").html(n.set("menuName")+"\u83dc\u5355\u6536\u8d77\u4e86")),n._tip.hide()}).on("keyup",function(t){var i=this.getValue(),r=this;n._updateMaxLength(i),i!=n._lastInputValue&&(n._lastInputValue=i,n.menu.hide(),n._tip.hide(),n._hideNumberInfo(),n._accept!=f.FIXED&&u.isTelNumber(i)?(e.log("[phone-number]user inputs a telephone number"+i),e.log("[phone-number]change the last valid number to "+i),e.log("[phone-number]try to show the number's info"),n._lastValidNumber=i,n._showTelNumberInfo(i)):""==i?(e.log("[phone-number]user inputs a empty number"),e.log("[phone-number]try to show his charging history"),l.get(function(t,i){t.length>0&&(n.menu.set("itemTemplate",g),e.each(t,function(e){e.value=e.number}),n.menu.show(t),n.set("menuName","\u5145\u503c\u5386\u53f2\u53f7\u7801\u83dc\u5355"),n.get("logNode").html(n.set("menuName")+"\u5c55\u5f00\u4e86\uff0c\u6309\u4e0a\u4e0b\u65b9\u5411\u952e\u8fdb\u884c\u5207\u6362\u9009\u9879\uff0c\u6309ENTER\u952e\u9009\u62e9\uff0c\u6309ESC\u952e\u6536\u8d77\u83dc\u5355"),n.menu.getMenuNode().one("ul").addClass("tbr-history"),i&&"cloud"==i&&n.menu.getMenuNode().one("ul").addClass("tbr-history-cloud"))})):(e.log("[phone-number]user inputs some numbers"),e.log("[phone-number]try to show suggestion"),l.get(function(e,t){n.menu.set("itemTemplate",v),e=n._filter(r.getValue(),e),n.menu.show(e),n.set("menuName","\u8054\u60f3\u53f7\u7801\u83dc\u5355"),n.get("logNode").html(n.set("menuName")+"\u5c55\u5f00\u4e86\uff0c\u6309\u4e0a\u4e0b\u65b9\u5411\u952e\u8fdb\u884c\u5207\u6362\u9009\u9879\uff0c\u6309ENTER\u952e\u9009\u62e9\uff0c\u6309ESC\u952e\u6536\u8d77\u83dc\u5355"),n.menu.getMenuNode().one("ul").removeClass("tbr-history"),t&&"cloud"==t&&n.menu.getMenuNode().one("ul").removeClass("tbr-history-cloud")})))}).on("keydown",function(t){var i;n.menu.isHidden()||(i=t.keyCode,i==d.UP?n.menu.set("selectedIndex",n.menu.get("selectedIndex")-1):i==d.DOWN?n.menu.set("selectedIndex",n.menu.get("selectedIndex")+1):i==d.ENTER?(n.menu.hide(),n._updateMaxLength(n.menu.getValue()),e.log("[phone-number]menu's value "+n.menu.getValue()),this.load(n.menu.getValue()),n.get("logNode").html(n.set("menuName")+"\u83dc\u5355\u6536\u8d77\u4e86\uff0c\u4f60\u9009\u62e9\u4e86"+n.menu.getValue()),c.goldlog("/wanle.10.3","","47700902")):i!=d.ESC&&i!=d.TAB||(n.menu.hide(),n.get("logNode").html(n.set("menuName")+"\u83dc\u5355\u6536\u8d77\u4e86")))}).on("change",function(t){var i,r;e.log("[phone-number]number is changed to "+t.newVal),e.log("[phone-number]last valid number is "+n._lastValidNumber),r=t.newVal,r!=n._lastValidNumber&&(i=u.validate(r,n._accept),i?(e.log("[phone-number]wrong number "+r),n._showError(),n._lastValidNumber=""):(n._tip.hide(),e.log("[phone-number]last valid number is "+r),n._lastValidNumber=r,u.isTelNumber(r)?n._showTelNumberInfo(r):n._showFixedNumberInfo(r)))}),this._iconNode.on("click",function(t){e.log("[phone-number]icon is clicked"),c.goldlog("/wanle.10.2","","47700902"),n._showHistory=!0,n._inputNode.getDOMNode().focus(),l.get(function(t,i){n._showHistory=!1,t.length>0?(n.menu.set("itemTemplate",g),e.each(t,function(e){e.value=e.number}),n.menu.show(t),n.set("menuName","\u5145\u503c\u5386\u53f2\u53f7\u7801\u83dc\u5355"),n.get("logNode").html(n.set("menuName")+"\u5c55\u4e86\uff0c\u6309\u4e0a\u4e0b\u65b9\u5411\u952e\u8fdb\u884c\u5207\u6362\u9009\u9879\uff0c\u6309ENTER\u952e\u9009\u62e9\uff0c\u6309ESC\u952et\u83dc\u5355"),n.menu.getMenuNode().one("ul").addClass("tbr-history"),i&&"cloud"==i&&n.menu.getMenuNode().one("ul").addClass("tbr-history-cloud")):n._tip.show("\u60a8\u8fd8\u6ca1\u6709\u5145\u503c\u8bb0\u5f55")})}),this.menu.on("select",function(t){var i=t.value;e.log("[phone-number]menu item is selected: "+i),c.goldlog("/wanle.10.3","","47700902"),n._updateMaxLength(i),n._numberInput.load(i),n._inputNode.getDOMNode().blur(),n.get("logNode").html("\u4f60\u9009\u62e9\u4e86"+i)}).on("highlight",function(e){e.node&&n._inputNode.attr("aria-activedescendant",e.node.prop("id"))})}var o=t("tbr/comp/numberTextInput2"),a=t("tbr/comp/textInputTip"),s=t("tbr/comp/textInputMenu"),l=t("tbr/history/phoneNumber"),u=t("tbr/utils/numberUtils"),d=t("tbr/utils/keycode"),c=t("tbr/utils/monitor"),h=t("util"),p=t("base"),b=t("dom"),m=t("node"),f=u.NUMBER_TYPE,g='<span class="tbr-number tbr-figure">{{number}}</span><span class="tbr-name">{{name}}</span><span class="tbr-delete" data-num="{{number}}">\u5220\u9664</span>',v='<span class="tbr-hit tbr-figure">{{hit}}</span><span class="tbr-left tbr-figure">{{left}}</span>';return h.extend(r,p,{"_filter":function(t,n){var i=u.format2(t),r=new RegExp("^("+i+")(.*)$"),o=[];return e.each(n,function(t){var n,i,a=u.format(t.number);r.test(a)&&(n=a.match(r),i=e.mix({},t),i.hit=n[1],i.left=n[2],i.value=t.number,o.push(i))}),0==o.length&&o.push({"hit":i,"value":t,"left":""}),o},"_showTelNumberInfo":function(t){var n=this;this._infoTimeout&&(this._infoTimeout.cancel(),this._infoTimeout=null),this._infoTimeout=e.later(function(){n._showNumberInfo('<p class="tbr-loading">\u8bf7\u7a0d\u5019...</p>')},1e3),u.getNumberInfo(t,function(i,r){n._infoTimeout&&(n._infoTimeout.cancel(),n._infoTimeout=null),e.log("[phone-number]info html text: "+e.substitute('<p class="tbr-success">{carrier}</p>',i)),n._showNumberInfo(e.substitute('<p class="tbr-success">{carrier}</p>',i)),r&&(i.area=r),n.set("value",{"numberType":f.TEL,"number":t,"carrier":i.carrier,"area":i.area})},function(i){n._infoTimeout&&(n._infoTimeout.cancel(),n._infoTimeout=null),n._showNumberInfo(e.substitute('<p class="tbr-error"><a href=//bangpai.taobao.com/group/233792.htm target="_blank">\u53f7\u7801\u4fe1\u606f\u672a\u77e5</a></p>',i)),n.set("value",{"numberType":f.TEL,"number":t,"carrier":"","area":""})})},"_showFixedNumberInfo":function(t){var n=u.getProvince(t);""!=n?(this._showNumberInfo(e.substitute('<p class="tbr-success">{area}{carrier}</p>',{"carrier":"\u56fa\u8bdd","area":n})),this.set("value",{"numberType":f.FIXED,"number":t,"carrier":"\u56fa\u8bdd","area":n})):(this._showNumberInfo(e.substitute('<p class="tbr-error"><a href=//bangpai.taobao.com/group/233792.htm target="_blank">\u53f7\u7801\u4fe1\u606f\u672a\u77e5</a></p>',data)),this.set("value",{"numberType":f.FIXED,"number":t,"carrier":"","area":""}))},"_showNumberInfo":function(t){e.log("[phone-number]show number info"),this._infoNode||(this._infoNode=m.one(b.create('<div class="tbr-numberinfo"></div>')),this._infoNode.appendTo(m.one("#tbr-phone-number"))),this._infoNode.html(t),this.get("logNode").html(this._infoNode.text()),this._infoNode.show()},"_hideNumberInfo":function(){e.log("[phone-number]hide number info"),this._infoNode&&this._infoNode.hide()},"_showError":function(t){e.isString(t)&&t&&(e.log("[phone-number]show msg "+t),this._tip.show(t)),this._hideNumberInfo(),this.reset("value")},"_updateMaxLength":function(e){/^1/.test(e)&&this._accept!=f.FIXED?(this._inputNode.prop("maxlength","11"),e.length>11&&this._numberInput.load(e.substring(0,11))):""!=e&&this._accept!=f.TEL&&this._inputNode.prop("maxlength","12")},"bindDeleteNum":function(){m.all(".tbr-delete").on("click",function(e){e.stopPropagation(),e.preventDefault();var t=e.target,n=m.one(t).attr("data-num");l.deleteNumber(n,function(e){m.one(t).parent().parent().remove()})})},"snapshot":function(){e.log("[phone-number]save "+this.get("value").number+" into localstorage"),l.addToLocalStorage(this.get("value").number)},"validate":function(){e.log("[phone-number]validating...");var t,n=this._numberInput.getValue();""!=n?(t=u.validate(n,this._accept),t?("\u53f7\u7801\u6709\u8bef\uff0c\u56fa\u8bdd\u8bf7\u52a0\u533a\u53f7"==t&&c.goldlog("/wanle.10.4","","47700902"),this._showError(t)):this._tip.hide()):this._showError("\u8bf7\u8f93\u5165\u53f7\u7801")}},{"ATTRS":{"value":{"value":{"number":"","numberType":f.UNKNOWN,"carrier":"","area":""}},"logNode":{"value":null},"menuName":{"value":"","validator":function(t){return e.isString(t)}}}}),r});KISSY.add("tbr/comp/rich-select",["dom","event","node","tbr/comp/rich-select.css"],function(t,e,n,i){"use strict";function r(e,n,i){if(!e)throw"rich-select: you must pass in a input element as first paramater!";this.initProperties(e,n,i),this.fillSelect(n,this.cfg),this.initUI(),this.regEvents();var r=this,o=this.cfg.selected;o&&(t.isArray(o)?r.selectOption.apply(r,o):r.selectOption(o))}var o=e("dom"),a=e("event"),s=e("node");e("tbr/comp/rich-select.css");var l=s.all,u="show",c="hide",d="onHide",h="onBeforeShow",p="onSelectChange",b="onSelectFilled",m="onSelectClear",f="onEnable",g="onDisable",v="onOptionRemove",_="onOptionAdd",x=37,N=38,I=39,y=40,w=13,k=27,T=9,C=".rich-select-title",q=".rich-select-body",S=".content-ctn",D=".J-option",M=".selected",V="show-as-table",A="selected",O="last-row-first-col",E="last-row-last-col",B="last-row",U="last-col",R="first-col",L="default",P='<div id="{id}" class="rich-select {selectClass}" role="menu" aria-haspopup="false"><div class="gap" style="display:none;"></div><div class="rich-select-title {titleClass}">{title}</div><div class="rich-select-body  {bodyClass}"><div class="content-ctn"><dl class="{listClass}"></dl></div><div class="scroll-ctn"><div class="scroll-bar"><b class="top-1"></b><b class="top-2"></b><b class="bottom-2"></b><b class="bottom-1"></b></div></div></div><div class="rich-select-footer {footerClass}" style="display:none;">{footer}</div></div>',H='<dd id="{id}" role="menuitem" data-value="{value}" data-text="{text}" data-row="{row}" data-col="{col}" data-idx="{idx}" class="J-option {posiClass}" style="width:{width}">{content}</dd>',F=function(t){return'<a href="javascript:;" title="'+t.text+'">'+t.text+"</a>"};return t.augment(r,{"getValue":function(){var t=this.selected,e=t?l(t).attr("data-value"):"";return e},"getText":function(){var t=this.selected,e=t?l(t).attr("data-text"):"";return e},"getOption":function(t){return this.optionData?this.optionData[t]:null},"getOptions":function(){return this.optionData},"show":function(){if(this.status!=u){var t=this.elem,e=this.getSelectPosi(),n=this.selected||l(t).all(D)[0];this.status=u,this.fire(h,{"posi":e,"elem":t},this.cfg.context),l(this.input).attr({"aria-haspopup":!0,"aria-expanded":!0}),l(t).attr({"aria-haspopup":!0,"aria-expanded":!0}),l(t).all(M).removeClass(A),l(n).addClass(A),l(t).css(e).show(),l(this.input)[0].focus(),this.updateScroll(),this.scrollOptionIntoView(n),this.selected?this.readSelectOption(this.selected):this.readActiveOption(n)}},"hide":function(){this.status!=c&&(this.status=c,this.fire(d,null,this.cfg.context),l(this.input).attr({"aria-haspopup":!1,"aria-expanded":!1}),l(this.elem).attr({"aria-haspopup":!1,"aria-expanded":!1}).hide())},"selectOption":function(){var t=arguments,e=this.getOptionNode(t);if(e&&0!=e.length){var n=!(t.length>1&&0==t[t.length-1]),i=(this.scrollBar,e.attr("data-text")),r=e.attr("data-value"),o=this.cfg;l(this.input).val(i.slice(0,o.inputMaxLen)),l(this.input).attr({"title":i,"data-value":r}),this.selected&&r==this.selected.attr("data-value")||(this.selected&&l(this.selected).removeClass(A),this.selected=e,this.scrollOptionIntoView(e),this.readSelectOption(e),n&&this.fire(p,{"text":i,"value":r},o.context))}},"fillSelect":function(t,e){l(this.input).val(""),this.isScrollUpdate=!1,this.optionData.length=0,this.selected=null,this.clearOptions(),this.renderOptions(t,e),this.status==u&&(this.updateScroll(),this.scrollOptionIntoView(this.selected||l(this.elem).all(D)[0])),e&&0==e.fireEvent||this.fire(b,{"options":t},this.cfg.context)},"cancelSelect":function(){var t=this.input;l(this.selected).removeClass(A),l(t).val("").attr({"title":"","data-value":""}),this.selected=null},"clear":function(){l(this.input).val(""),this.selected=null,this.optionData.length=0,this.isScrollUpdate=!1,this.clearOptions(),this.status==u&&(this.updateScroll(),this.scrollOptionIntoView(this.selected||l(this.elem).all(D)[0])),this.fire(m,null,this.cfg.context)},"setOptionContentRender":function(e){t.isFunction(e)&&(this.optionContentRender=e)},"addOption":function(e){e=t.isArray(e)?e:[e],this.renderOptions(e),this.isScrollUpdate=!1,this.status==u&&(this.updateScroll(),this.scrollOptionIntoView(this.selected||l(this.elem).all(D)[0])),this.fire(_,e,this.cfg.context)},"removeOption":function(){var t,e,n,i,r,o,a,s,c,d,h,b=Array.prototype.slice.call(arguments),m=this.getOptionNode(b),f=parseInt(l(m).attr("data-idx"),10),g=l(this.elem).all(q).all("dd"),_=this.optionData,x=this.cfg;for(l(m).remove(),o=_.splice(f,1),a=this.cfg.cols,s=this.getRowCount(),h=this.getColWidthFn(x.width,a,x.scrollWidth,x.optionBoxInfo),t=f,e=_.length;t<e;t++)n=g[t],d=t%a,c=Math.floor(t/a),i=n.className,r=this.getPosiClass(c,d,s,a),l(n).attr({"data-idx":t,"data-row":c,"data-col":d,"class":i.replace(/\blast-\w+\b/,r)}).css("width",h(r));this.isScrollUpdate=!1,this.status==u&&(this.updateScroll(),this.scrollOptionIntoView(this.selected||l(this.elem).all(D)[0])),l(this.selected).attr("data-idx")==f&&(this.selected=null,l(this.input).val("").attr({"title":"","data-value":""}),this.fire(p,{"text":"","value":""},this.cfg.context)),this.fire(v,o,this.cfg.context)},"setEnable":function(t){var e=t?f:g;this.hide(),l(this.input).attr("disabled",!t),this.fire(e,null,this.cfg.context)},"isEnable":function(){return!l(this.input).attr("disabled")},"onInputBlur":function(t){var e=this;this.isCursorIn=!1,window.setTimeout(function(){e.isCursorIn||e.hide()},200)},"onInputFocus":function(t){this.isCursorIn=!0},"onInputClick":function(t){var e=this.input;1!=l(e)[0].disabled&&(this.status!=u?this.show():this.hide())},"onOptionClick":function(t){t.preventDefault();var e=l(t.currentTarget);e!=this.selected&&this.selectOption(e),this.hide()},"onKeydown":function(t){var e,n,i=this.elem,r=t.keyCode;if(r!=T)return t.preventDefault(),r==w?void(this.status==c?this.show():(e=l(i).all(M),this.selectOption(e),this.hide())):r==k?void(this.status==u&&(this.hide(),l(this.input)[0].focus())):r==N||r==I||r==y||r==x?(e=l(i).all(M)[0]||l(i).all(D)[0],n=this.focusNext(e,r),void this.readActiveOption(n)):void 0},"onWinResize":function(t){if(this.status==u){var e=this.elem,n=this.getSelectPosi();l(e).css(n)}},"onScrollMouseDown":function(t){if(2!=t.button){t.preventDefault();var e=t.clientY,n=l(this.scrollBar)[0],i=l(this.elem).all(S)[0],r=parseInt(l(n).css("top"),10),o=i.scrollHeight,s=i.offsetHeight,u=o/s,c=r-e,d=s-l(n).height(),h=0,p=function(){a.remove(document.body,"mouseup",p),a.remove(document.body,"mousemove",b),document.all&&n.releaseCapture()},b=function(t){var e=t.clientY,r=e+c<=h?h:e+c>=d?d:e+c;l(n).css("top",r+"px"),l(i).scrollTop(Math.floor(r*u)+"px")};a.on(document.body,"mouseup",p),a.on(document.body,"mousemove",b),document.all&&n.setCapture()}},"renderFrame":function(e,n){var i=n.template||P,e=t.merge({"id":this.id},n);return o.create(t.substitute(i,e))},"renderOptions":function(e,n){n=n||{};var i,r=this.cfg,a=l(this.elem).all("dl")[0],s=this.optionData,u=this;n.colCount&&n.colCount!=r.cols&&(i=a.className,r.cols=n.colCount,a.className=i.replace(/\bcol\d/," col"+n.colCount+" ")),s.push.apply(s,e);var c=r.cols,d=this.getRowCount(),h=n.optionTemplate||H,p=this.optionContentRender,b=this.getColWidthFn(r.width,c,r.scrollWidth,r.optionBoxInfo);t.each(e,function(e,n){var i=n%c,r=Math.floor(n/c),s=u.getPosiClass(r,i,d,c),m=t.substitute(h,t.merge({"content":p(e),"posiClass":s,"id":"_mi_"+t.guid(),"row":r,"col":i,"idx":n,"width":b(s)},e));l(a).append(o.create(m))})},"clearOptions":function(){var t=l(this.elem).all("dl");t.all(D).remove()},"getSelectPosi":function(){var t=this.cfg,e=t.align,n=t.alignTo,i=t.xoffset,r=t.yoffset,a=o.offset(n),s="left"!=e?"right":"left",u={"top":a.top+l(n).height()+r};return u[s]=a[s]+i,u},"getColWidthFn":function(t,e,n,i){var r=t-n,o=Math.floor(r/e),a=r%e,s=i.lb||0,l=i.rb||0,u=i.lp||0,c=i.rp||0,d=o-s-u-l-c+"px",h=o+a-u-l-c+"px",p=o-u-l-c+"px",b={};return b[L]=d,b[R]=h,b[U]=p,b[O]=h,b[E]=p,function(t){return b[t]||b[L]}},"getPosiClass":function(t,e,n,i){return t==n-1&&e==i-1?E:t==n-1&&0==e?O:t==n-1?B:e==i-1?U:0==e?R:""},"getConfig":function(e,n){var i=n.fireClickArea||l(e).parent(),r=n.alignTo||e,o=l(r).width(),a=t.merge({"fireClickArea":i,"showScroll":!1,"displayRows":8,"cols":1,"xoffset":0,"yoffset":0,"width":o,"align":"left","alignTo":r,"context":this,"inputMaxLen":100},n);return a.hasOwnProperty("scrollWidth")||(a.scrollWidth=a.showScroll?10:0),a.optionBoxInfo||(a.optionBoxInfo=a.listClass==V?{"lb":1,"lp":0,"rb":1,"rp":0}:{"lb":0,"lp":0,"rb":0,"rp":4}),a},"getRowCount":function(){var t=this.cfg.cols,e=this.optionData;return e?Math.ceil(e.length/t):0},"focusNext":function(e,n){var i=parseInt(l(e).attr("data-idx"),10),r=(l(e).attr("data-row"),l(e).attr("data-col"),l(this.elem).all(D)),o=this.cfg.cols,a=r.length,s=n==x?-1:n==N?-o:n==I?1:n==y?o:0,u=i+s<0?0:i+s>=a?a-1:i+s,c=r[u];return t.each(r,function(t,e){t==c?l(t).addClass(A):l(t).removeClass(A)}),this.scrollOptionIntoView(c),c},"readActiveOption":function(t){var e=l(this.input),n=l(t).attr("id");e.attr("aria-activedescendant",n)},"readSelectOption":function(t){var e=(l(this.input),l(t).attr("id"),l(t).attr("data-text"));t.attr({"title":"\u60a8\u9009\u62e9\u4e86:"+e,"aria-label":"\u60a8\u9009\u62e9\u4e86:"+e})},"initProperties":function(e,n,i){i=this.getConfig(e,i),this.id=i.id||"_rs_"+t.guid(),this.status=c,this.eventMap={},this.selected=null,this.optionData=[],this.isCursorIn=!1,this.isScrollUpdate=!1,this.optionContentRender=t.isFunction(i.optionContentRender)?i.optionContentRender:F,this.cfg=i,this.input=l(e),this.elem=this.renderFrame(n,i),this.scrollCtn=l(this.elem).all(".scroll-ctn"),this.scrollBar=l(this.scrollCtn).all(".scroll-bar")},"initUI":function(){var t=this.elem,e=this.cfg,n=document.body,i=this.input,r=e.label;l(i).attr({"role":"combobox","title":r,"aria-ows":this.id,"readOnly":!0,"aria-live":"assertive","aria-label":r,"aria-readOnly":!0,"aria-haspopup":"false","aria-expanded":"false","aria-autocomplete":"list"}),l(t).hide(),l(n).append(this.elem),e.width&&l(t).css("width",e.width+"px"),e.title||l(t).all(C).hide(),e.showGap&&this.initGap()},"initGap":function(){return},"regEvents":function(){var t=this.input,e=this.elem,n=this.cfg,i=n.fireClickArea;a.on(window,"resize",this.onWinResize,this),a.on(t,"blur",this.onInputBlur,this),a.on(t,"focus",this.onInputFocus,this),a.on(t,"keydown",this.onKeydown,this),a.on(i,"click",this.onInputClick,this),a.on(this.scrollBar,"mousedown",this.onScrollMouseDown,this),a.delegate(e,"click",D,this.onOptionClick,this)},"updateScroll":function(){var t=this.cfg,e=l(this.elem),n=e.all(S),i=this.scrollCtn,r=this.optionData;if(t.showScroll&&!this.isScrollUpdate){if(this.isScrollUpdate=!0,!r||0==r.length)return n.css("height","auto"),void i.hide();var o,a=this.scrollBar,s=t.displayRows,u=e.all("dd"),c=u[0],d=(t.cols,this.getRowCount()),h=l(c).height()+parseInt(l(c).css("marginTop"),10)+parseInt(l(c).css("marginBottom"),10),p=s*h;d<=s?(n.css("height","auto"),i.hide()):(o=Math.floor(p*s/d)%2==0?Math.floor(p*s/d):Math.floor(p*s/d)-1,a.css("height",o+"px"),n.css("height",p+"px"),i.show())}},"scrollOptionIntoView":function(t){if(t&&this.cfg.showScroll){t=l(t)[0];var e=this.scrollBar,n=l(this.elem),i=n.all(S)[0],r=i.getBoundingClientRect(),o=t.getBoundingClientRect(),a=o.top>=r.top&&o.bottom<=r.bottom;if(!a){var s,u=l(i).height(),c=i.scrollHeight;return o.bottom>r.bottom?(s=i.scrollTop+o.bottom-r.bottom,i.scrollTop=s,void l(e).css("top",Math.floor(s*u/c)+"px")):void(o.top<r.top&&(s=i.scrollTop+o.top-r.top,i.scrollTop=s,l(e).css("top",Math.floor(s*u/c)+"px")))}}},"getOptionNode":function(e){if(1==e.length&&"object"==typeof e[0])return l(e[0]);var n=l(this.elem).all(D);if(1==e.length&&"number"==typeof e[0])return l(n[e[0]]);var i=null,r=e[1],o="text"==e[0]?"text":"value";return t.each(n,function(t){var e=l(t).attr("data-"+o);e==r&&(i=t)}),l(i)},"on":function(t,e,n){var i=this.eventMap[t]||(this.eventMap[t]=[]);i.push(e,n)},"fire":function(e,n,i){var r=this.eventMap[e];if(r&&0!=r.length){var o,a,s=[].slice.call(arguments),i=s.length>2?s[s.length-1]:null,n=s.length>2?s.slice(1,s.length-1):[],l=r.length;for(o=0;o<l;o++)if(a=r[o],"function"==typeof a)try{a.apply(i,n)}catch(u){t.error("rich-select: call event["+e+"]'s handler error, info: "+u)}}}}),r});KISSY.add("tbr/url/base",[],function(t,e,n,i){function r(t){this._env=t.env,this._init(t.type)}return t.augment(r,{"_init":function(e){var n;e&&t.inArray(e,["phone","qq","card"])||t.error("[url]\u7c7b\u522b\u9519\u8bef"),n=t.namespace("tbr",t),n&&n[e]||t.error("[url]\u6570\u636e\u9519\u8bef"),this._skuDataMap=n[e].skuDataMap,this._denomDataMap=n[e].denomDataMap,this._promotion=n.promotion,this._requestUrlBase=n.requestUrlBase[e],this._searchUrlBase=n.searchUrlBase,this._requestUrlDataCache={},this._searchUrlDataCache={}},"_validateParamArr":function(e){var n=!0;return t.each(e,function(e){if(!t.isString(e)||""==e)return n=!1,!1}),n},"_validateForReqeust":function(t){return!1},"_validateForSearch":function(t){return!1},"_generateRequestUrlData":function(t){return null},"_generateSearchUrlData":function(t){return null},"_getRequestUrlSPU":function(t){return""},"_getSearchUrlSPU":function(t){return""},"_getRequestUrlData":function(t){var e,n;return this._validateForReqeust(t)?(e=this._getRequestUrlSPU(t),n=this._requestUrlDataCache[e],n||(n=this._generateRequestUrlData(t)),n||(this._requestUrlDataCache[e]=n)):n={"url":""},n},"getRequestUrl":function(t){return this._getRequestUrlData(t).url},"_getSearchUrlData":function(t){var e,n;return this._validateForSearch(t)?(e=this._getSearchUrlSPU(t),n=this._searchUrlDataCache[e],n||(n=this._generateSearchUrlData(t)),n||(this._searchUrlDataCache[e]=n)):n={"url":""},n},"getSearchUrl":function(t){return this._getSearchUrlData(t).url}}),r});KISSY.add("tbr/data/phone",[],function(t,e,n,i){var r={};return r.CARRIER_CODE={"\u79fb\u52a8":["20779","20780","20789"],"\u8054\u901a":["20781","20782","20790"],"\u7535\u4fe1":["1626917","1626918","1626919"],"\u56fa\u8bdd":["20791","20792"],"\u963f\u91cc\u901a\u4fe1":["21940","20780"]},r.CARRIER_ID_TO_REQUEST={"\u79fb\u52a8":"150401","\u8054\u901a":"150402","\u7535\u4fe1":"50011814","\u963f\u91cc\u901a\u4fe1":"126998001"},r.CARRIER_ID_TO_SEARCH={"\u79fb\u52a8":"150401","\u8054\u901a":"150402","\u7535\u4fe1":"50018446","\u56fa\u8bdd":"150406"},r.PROVINCE_CODE={"\u5168\u56fd":"30680","\u897f\u85cf":"27009","\u5317\u4eac":"29400","\u91cd\u5e86":"29404","\u4e0a\u6d77":"29423","\u5929\u6d25":"29428","\u5185\u8499\u53e4":"30495","\u9ed1\u9f99\u6c5f":"30496","\u5409\u6797":"30497","\u8fbd\u5b81":"30498","\u6cb3\u5317":"30499","\u6cb3\u5357":"30500","\u5c71\u4e1c":"30501","\u5c71\u897f":"30502","\u9655\u897f":"30503","\u9752\u6d77":"30504","\u7518\u8083":"30505","\u65b0\u7586":"30506","\u5b81\u590f":"30507","\u56db\u5ddd":"30508","\u5b89\u5fbd":"30509","\u6d59\u6c5f":"30510","\u6c5f\u82cf":"30511","\u6c5f\u897f":"30512","\u6e56\u5317":"30513","\u6e56\u5357":"30514","\u4e91\u5357":"30515","\u8d35\u5dde":"30516","\u5e7f\u4e1c":"30517","\u5e7f\u897f":"30518","\u798f\u5efa":"30519","\u6d77\u5357":"30520"},r.DENOM_CODE={"1":"30675","10":"30676","20":"30677","30":"30688","50":"30678","100":"30679","133":"38584","200":"30690","300":"30691","500":"30692","1000":"38182"},r.DENOM_INTERVAL_TO_REQUEST={"150401-tbcp-1":"1.2,2","150401-tbcp-10":"9.9,12","150401-tbcp-20":"20,23","150401-tbcp-30":"29.5,32","150401-tbcp-50":"49,50","150401-tbcp-100":"98,100","150401-tbcp-200":"196.4,200","150401-tbcp-300":"294.6,300","150401-tbcp-500":"490,500","150401-tbcp-1000":"984,1000","150402-tbcp-1":"1.2,2","150402-tbcp-10":"9.7,12","150402-tbcp-20":"19.4,23","150402-tbcp-30":"29.4,32","150402-tbcp-50":"49,50","150402-tbcp-100":"98,100","150402-tbcp-133":"130,135","150402-tbcp-200":"196.4,200","150402-tbcp-300":"294.6,300","150402-tbcp-500":"490,500","150402-tbcp-1000":"984,1000","50011814-tbcp-1":"1.2,2","50011814-tbcp-10":"9.9,12","50011814-tbcp-20":"20,23","50011814-tbcp-30":"29.5,32","50011814-tbcp-50":"49,50","50011814-tbcp-100":"98,100","50011814-tbcp-200":"196.4,200","50011814-tbcp-300":"294.6,300","50011814-tbcp-500":"490,500","50011814-tbcp-1000":"984,1000","150401-ecard-10":"9,10.6","150401-ecard-20":"18,20.5","150401-ecard-30":"28,30.5","150401-ecard-50":"45.0,49.98","150401-ecard-100":"96.0,99.98","150401-ecard-200":"190,199.6","150401-ecard-300":"290,299.5","150401-ecard-500":"490,498","150401-ecard-1000":"990,999","150402-ecard-10":"9,10.5","150402-ecard-20":"19,20.5","150402-ecard-30":"29,30.5","150402-ecard-50":"45.0,49.98","150402-ecard-100":"96.0,99.98","150402-ecard-133":"130,133","150402-ecard-200":"199,199.9","150402-ecard-300":"290,299","150402-ecard-500":"490,499","150402-ecard-1000":"990,999","50011814-ecard-10":"9,10.5","50011814-ecard-20":"19,20.5","50011814-ecard-30":"29,30.5","50011814-ecard-50":"45.0,49.98","50011814-ecard-100":"96.0,99.98","50011814-ecard-200":"190,199.9","50011814-ecard-300":"290,298","50011814-ecard-500":"490,499","50011814-ecard-1000":"990,999"},r.DENOM_INTERVAL_TO_SHOW={"tbcp-1":"0.98,1.5","tbcp-10":"10,10.6","tbcp-20":"19.84,20.8","tbcp-30":"29.58,31.5","tbcp-50":"49.3,49.9","tbcp-100":"98,99.6","tbcp-133":"130.3,131.6","tbcp-200":"199,199.5","tbcp-300":"299,299.3","tbcp-500":"498,498.9","tbcp-1000":"980,990","ecard-1":"0.98,1.5","ecard-10":"9.8,9.9","ecard-20":"19.6,20","ecard-30":"29.4,30","ecard-50":"49,49.8","ecard-100":"98,99.5","ecard-133":"130.3,131.6","ecard-200":"196,199","ecard-300":"294,299","ecard-500":"490,498","ecard-1000":"980,990"},r.findECardPrice=function(t,e){var n=e?this.DENOM_INTERVAL_TO_REQUEST[e+"-ecard-"+t]:this.DENOM_INTERVAL_TO_SHOW["ecard-"+t];return n?n.split(","):[]},r.findCarrierCatId=function(t){return this.CARRIER_ID_TO_REQUEST[t]||""},r.findCarrierCode=function(t){return this.CARRIER_CODE[t]||[]},r.findDenomCode=function(t){return this.DENOM_CODE[""+t]||""},r.findProvinceCode=function(t){return this.PROVINCE_CODE[t]||""},r});