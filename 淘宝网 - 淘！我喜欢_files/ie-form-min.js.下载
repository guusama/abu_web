/*! Generated by Clam: ntrip */
KISSY.add("ntrip/mods/ie/ie-form",["node","event","base","../common/trip-form","../common/trip-common"],function(a,b){var c=b("node"),d=(b("event"),b("base")),e=b("../common/trip-form"),f=b("../common/trip-common"),g=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,h={depCityNull:"\u8bf7\u9009\u62e9\u51fa\u53d1\u57ce\u5e02",arrCityNull:"\u8bf7\u9009\u62e9\u5230\u8fbe\u57ce\u5e02",sameCity:"\u51fa\u53d1\u57ce\u5e02\u548c\u5230\u8fbe\u57ce\u5e02\u4e0d\u80fd\u76f8\u540c",earlyThanToday:"\u51fa\u53d1\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u4eca\u5929",depTime:"\u8bf7\u9009\u62e9\u51fa\u53d1\u65e5\u671f",depTimeFormat:"\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",depOneYearLater:"\u51fa\u53d1\u65e5\u671f\u4e0d\u80fd\u4e3a\u4e00\u5e74\u4ee5\u540e",arrTime:"\u8bf7\u9009\u62e9\u8fd4\u7a0b\u65e5\u671f",arrTimeFormat:"\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",arrOneYearLater:"\u8fd4\u7a0b\u65e5\u671f\u4e0d\u80fd\u4e3a\u4e00\u5e74\u4ee5\u540e",depLaterArr:"\u8fd4\u7a0b\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u51fa\u53d1\u65e5\u671f",autoCompleteNull:'\u5bf9\u4e0d\u8d77\uff0c\u6ca1\u6709\u627e\u5230<span class="conve-error">"{userInput}"</span>'},i=d.extend({initializer:function(){var a=this;a.formNode=c.one("#J_ie_form"),a.type=c.all("#J_ieType input"),a.depCity=c.one("#J_ieDepCity"),a.arrCity=c.one("#J_ieArrCity"),a.depTime=c.one("#J_ieDepTime"),a.arrTime=c.one("#J_ieArrTime"),a.icon=a.formNode.one(".J_tripGo"),a._init(),a._bindUI()},_init:function(){var b=this;b.formObj=new e({id:"#J_ie_form",calendar:[{id:"ieCalendar",triggerNode:b.depTime,finalTriggerNode:b.arrTime,minDate:new Date,isDateIcon:!0,isHoliday:!0,isDateInfo:!1}],autoComplete:[{inputNode:"#J_ieDepCity",hotSource:"//www.alitrip.com/go/rgn/trip/city/international.php",source:"//sijipiao.alitrip.com/ie/auto_complete.do?_input_charset=utf-8&count=20&userInput={query}",resultListLocator:"result",resultTextLocator:"name",wrapperClass:"conve-complete J_convePop",width:b.depCity.parent(".conve-input").outerWidth(),align:{node:b.depCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}},{inputNode:"#J_ieArrCity",hotSource:"//www.alitrip.com/go/rgn/trip/city/international.php",source:"//sijipiao.alitrip.com/ie/auto_complete.do?_input_charset=utf-8&count=20&userInput={query}",resultListLocator:"result",resultTextLocator:"name",wrapperClass:"conve-complete J_convePop",width:b.arrCity.parent(".conve-input").outerWidth(),align:{node:b.arrCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}}]}),b.depCityAutoComplete=b.formObj.getAutoCompleteById("#J_ieDepCity"),b.arrCityAutoComplete=b.formObj.getAutoCompleteById("#J_ieArrCity"),b.calendar=b.formObj.getCalendarById("ieCalendar"),a.each(b.type,function(a){var d=c.one(a);d.attr("checked")&&(b.typeVal=d.val(),b.changeType())})},_bindUI:function(){var a=this;a.formNode.on("submit",a.submitForm,a),a.type.on("click",a.changeType,a)},submitForm:function(){var a=this;a._validate()&&(a.formObj.storeFormInfo(),a.formNode.getDOMNode().submit())},changeType:function(b){var d=this;b&&(d.typeVal=c.one(b.currentTarget).val()),0==d.typeVal?(d.arrTime.val(""),d.arrTime.parent(".conve-input").hide(),d.calendar.set("endDate",""),d.calendar.set("selectedDate",a.trim(d.depTime.val())),d.calendar.render(),d.icon.removeClass("conve-trip-exchange")):(d.arrTime.parent(".conve-input").show(),d.icon.addClass("conve-trip-exchange"))},_validate:function(){var b=this,c=(new Date).setHours(0,0,0,0);if(!f.checkNull(b.depCity))return b.depCityAutoComplete.showMessage(h.depCityNull),!1;if(!f.checkNull(b.arrCity))return b.arrCityAutoComplete.showMessage(h.arrCityNull),!1;if(!f.isDiff(b.depCity,b.arrCity))return b.arrCityAutoComplete.showMessage(h.sameCity),!1;if(!f.checkNull(b.depTime))return b.calendar.set("message",h.depTime),b.calendar.showMessage(),!1;if(!f.checkFormat(b.depTime,g))return b.calendar.set("message",h.depTimeFormat),b.calendar.showMessage(),!1;var d=a.trim(b.depTime.val());if(f.parseDate(d)<c)return b.depTime.getDOMNode().focus(),b.calendar.set("message",h.earlyThanToday),b.calendar.showMessage(),!1;if(!f.isOneYearLater(d))return b.depTime.getDOMNode().focus(),b.calendar.set("message",h.depOneYearLater),b.calendar.showMessage(),!1;if(1==b.typeVal){if(!f.checkNull(b.arrTime))return b.calendar.set("message",h.arrTime),b.calendar.showMessage(),!1;if(!f.checkFormat(b.arrTime,g))return b.calendar.set("message",h.arrTimeFormat),b.calendar.showMessage(),!1;if(!f.isOneYearLater(a.trim(b.arrTime.val())))return b.arrTime.getDOMNode().focus(),b.calendar.set("message",h.arrOneYearLater),b.calendar.showMessage(),!1;if(f.getDays(a.trim(b.arrTime.val()),d)>0)return b.arrTime.getDOMNode().focus(),b.calendar.set("message",h.depLaterArr),b.calendar.showMessage(),!1}return!0}});return i});