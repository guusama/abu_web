KISSY.add("tbr/control/phone/index",["tbr/control/phone/number","tbr/comp/rich-select","util","base","node"],function(t,e,n,i){function r(t){r.superclass.constructor.call(this),this.number=new a,this.denomSelect=this.initDenomSelect(),this.regEvents(t)}var a=e("tbr/control/phone/number"),o=e("tbr/comp/rich-select"),s=e("util"),l=e("base"),u=e("node");return s.extend(r,l,{"init":function(){var e=this.denomSelect.getValue();e&&this.set("value",t.merge(this.get("value"),{"denom":e},this.number.get("value"),{"request":!0}))},"snapshot":function(){this.number.snapshot()},"validate":function(){function e(t,n){return"undefined"==typeof goldlog?void setTimeout(e,200):void(goldlog.record&&goldlog.record(t,"","",n))}this.number.validate();var n=u.all,i=this,r=this.number.get("value");if(""!==r.number&&"off"!=window.SW_FRESHMAN&&n(".pay-mobile").length&&n(".pay-mobile").hasClass("cur")){e("/wap.1002.2","47700902");var a=this.number.get("value");this.number.reset("value"),n("#tbr-phone .J_LaxPopWrap").length||n("#tbr-phone").append('<div class="laxpop-wrap"><a href="#" class="J_LaxReturn">< \u8fd4\u56de</a><div class="J_LaxPopWrap"></div></div>'),n("#tbr-phone").addClass("show-pop");var o=location.href.indexOf("daily.taobao.net")!=-1?"//g-assets.daily.taobao.net":"//g.alicdn.com";t.getScript(o+"/mtb/app-laxin/0.1.4/lxpop.debug.min.js",function(){t.use("laxinPop",function(t,e){e.init({"container":".J_LaxPopWrap","type":"mini","flag":5}),i.number.set("value",a)})})}},"initDenomSelect":function(){var t=u.one("#tbr-select-denom"),e=t.parent(".conve-input"),n=[{"text":"100\u5143","value":100},{"text":"10\u5143","value":10},{"text":"200\u5143","value":200},{"text":"20\u5143","value":20},{"text":"300\u5143","value":300},{"text":"30\u5143","value":30},{"text":"500\u5143","value":500},{"text":"50\u5143","value":50},{"text":"1000\u5143","value":1e3}],i=function(t){return'<a href="//www.taobao.com" tabindex="-1" target="_blank" hidefocus="true"><span class="tbr-figure">'+t.value+"</span>\u5143</a>"},r=new o(t,n,{"optionContentRender":i,"listClass":"show-as-table","selected":["value",50],"alignTo":e,"cols":2,"selectClass":"J_convePop"});return r},"regEvents":function(e){var n=this;this.denomSelect.on("onSelectChange",function(e){var i=t.merge(n.get("value"),{"denom":e.value,"request":!0});n.set("value",i)}),this.number.on("afterValueChange",function(e){n.set("value",t.merge(n.get("value"),e.newVal,{"request":!0}))}),this.on("afterValueChange",function(e){t.log("[phone-control]value is changed")});var i=u.all,r=e.containerNode;r.delegate("click",".pay-btn",function(t){t.preventDefault();var e=t.currentTarget;r.all(".pay-btn").removeClass("cur"),i(e).addClass("cur"),i(e).hasClass("pay-mobile")?r.one(".tbr-btn-buy").text("\u624b\u673a\u5145\u503c"):r.one(".tbr-btn-buy").text("\u7acb\u523b\u5145\u503c")}),r.delegate("click",".J_LaxReturn",function(t){t.preventDefault(),i("#tbr-phone").removeClass("show-pop")});var a=t.namespace("tbr",t).phone.itemData,o=r.all("#J_CheckUseThf");a.useTaohuafee=o.prop("checked"),o.on("change",function(t){a.useTaohuafee=o.prop("checked")})}},{"ATTRS":{"value":{"value":{"itemType":"ecard"}}}}),r});KISSY.add("tbr/request",["event","event-custom","io"],function(e,t,n,r){var i=t("event"),o=(t("event-custom"),t("io")),a=function(t){return t&&e.inArray(t.type,["phone","card","qq"])?void(this.type=t.type):void e.error("request obj needs a type")},s={};return s.get=function(t,n){var r=null,i=this;r=e.later(function(){i.fire("loading")},1e3),o({"url":t,"dataType":"jsonp","timeout":5,"scriptCharset":"gbk","cache":!1,"complete":function(){r.cancel(),r=null},"error":function(e,t){i.fire("error",{"errorType":t,"itemId":"","skuId":"","itemType":""})},"success":function(e){var t,r;"phone"==i.type?""==e.item_id_num?i.fire("error",{"errorType":"exception","itemId":"","skuId":"","itemType":""}):"\u6682\u7f3a"==e.item_id_num?i.fire("error",{"errorType":"stockout","itemId":"","skuId":"","itemType":""}):(e.platform?e.itemType="tbcp":e.itemType="ecard",e.itemId=e.item_id_num,e.skuId=e.sku_id,i.fire("success",{"result":e,"formData":n})):("card"==i.type?"auto"==n.itemType?(r=e.ecard,r?t="ecard":(r=e.tbcp,r&&(t="tbcp"))):(r=e.cardcode,r&&(t="cardcode")):"qq"==i.type&&(r=e.ecard,r?t="ecard":(r=e.tbcp,r&&(t="tbcp"))),r?(r.itemType=t,i.fire("success",{"result":r})):i.fire("error",{"errorType":"stockout","itemId":"","skuId":"","itemType":""}))}})},e.augment(a,i.Target,s),a});KISSY.add("tbr/url/phone",["tbr/url/base","tbr/data/phone"],function(t,e,n,r){function i(e){i.superclass.constructor.call(this,t.mix({"type":"phone"},e))}var o=e("tbr/url/base"),a=e("tbr/data/phone");return t.extend(i,o,{"_validateForReqeust":function(t){return this._validateParamArr([t.denom,t.carrier,t.area,t.itemType])},"_validateForSearch":function(t){return this._validateParamArr([t.denom,t.carrier,t.area,t.itemType])},"_generateRequestUrlData":function(e){var n={},r=e.carrier;if("\u56fa\u8bdd"==e.carrier&&(r="\u7535\u4fe1"),n.cat=a.findCarrierCatId(r),n.reserve_price=e.denom+"\u5143","fixed"==e.numberType&&(n.fix="1"),"ecard"==e.itemType?n.search_type="ecard_auction":n.search_type="mobile_card",n.filter="reserve_price["+a.findECardPrice(e.denom,n.cat).join(",")+"]",""!=this._promotion)switch(this._promotion){case"taojinbi":n.tbcoin="1";break;case"jhs":n.ptype="jhs",n.feetype="1";break;case"etao":n.ptype="etao"}return n.commend="all",n._input_charset="utf-8",n.css=this._env,n.denom=e.denom,n.phone=e.number,n.url=this._requestUrlBase+"?"+t.param(n),n},"_generateSearchUrlData":function(e){var n={};return"fixed"!=e.numberType&&("ecard"==e.itemType?itemTypeVId="6076017":"\u79fb\u52a8"==e.carrier?itemTypeVId="84923":itemTypeVId="90682"),"tbcp"==e.itemType&&(n.viewIndex=1,n.ptdc=1),n.url=this._searchUrlBase+"?"+t.param(n),n},"_getRequestUrlSPU":function(e){return t.substitute("{area}-{carrier}-{denom}-{itemType}",e)},"_getSearchUrlSPU":function(e){return t.substitute("{area}-{carrier}-{denom}-{itemType}",e)},"getIntervalArr":function(t){var e=a.findCarrierCatId(t.carrier);return a.findECardPrice(t.denom,e)}}),i});KISSY.add("tbr/result/general2",["tbr/utils/monitor","event","event-custom"],function(t,e,n,r){var i=e("tbr/utils/monitor"),o=e("event"),a=(e("event-custom"),"&yen;"),s="\u5143",l="tbr-instock tbr-stockout tbr-loading tbr-error tbr-initial",u=function(e){try{this.resultNode=e.containerNode.one(".tbr-result"),this.buyBtnNode=e.containerNode.one(".tbr-btn-buy"),this.bdNode=this.resultNode.one(".tbr-block-bd"),this.hdLabelNode=this.resultNode.one(".tbr-result-label"),this.priceStyle=t.namespace("tbr",t).priceStyle||"taobao",this.tbrContainerNode=e.containerNode,this.type=e.type}catch(n){t.error("result initialization fails")}},d='<ul class="paychannel"><li><a href="#" class="pay-btn pay-pc">\u7535\u8111<b>{unit}{price1}\u8d77</b><em></em></a></li><li><a href="#" class="pay-btn pay-mobile cur">\u624b\u673a<b>{unit}{price2}\u8d77</b><span>\u51cf5\u5143</span><em></em></a></li></ul>',c=function(){var e=t.namespace("tbr",t),n=e.phone&&e.phone.data&&e.phone.data.denom;return e.isNew&&n>=50&&n<1e3},h=function(t,e){return"undefined"==typeof goldlog?void setTimeout(h,200):void(goldlog.record&&goldlog.record(t,"","",e))};return t.augment(u,o.Target,{"printPrice":function(e){var n=e.price;this.tbrContainerNode.removeClass(l).addClass("tbr-instock"),this.resultNode.show(),this.buyBtnNode.show(),this.hdLabelNode&&this.hdLabelNode.html("\u552e\u4ef7"),"taobao"!=this.priceStyle?this.bdNode.html(t.substitute('<span class="tbr-price"><strong>{price}</strong><span>{unit}</span></span>',{"unit":s,"price":n})):c()&&"phone"==this.type?this.printPayChannel([e.price,e.newPrice]):(this.buyBtnNode.text("\u7acb\u523b\u5145\u503c"),this.bdNode.parent(".tbr-block").removeClass("paychannel-block"),this.bdNode.html(t.substitute('<span class="tbr-price"><span>{unit}</span><strong>{price}</strong></span>',{"unit":a,"price":n})))},"printStockout":function(e){var n,r=e.url;this.tbrContainerNode.removeClass(l).addClass("tbr-stockout"),this.resultNode.show(),this.buyBtnNode.hide(),this.hdLabelNode?(this.hdLabelNode.html("\u6682\u7f3a"),n="\u70b9\u51fb\u641c\u7d22\u6216\u9009\u62e9\u5176\u4ed6\u9762\u503c"):n="\u7f3a\u8d27\uff0c\u70b9\u51fb\u641c\u7d22\u6216\u9009\u62e9\u5176\u4ed6\u9762\u503c",this.bdNode.html(t.substitute('<a href="{url}" target="_blank" class="tbr-stockout-link">{text}</a>',{"url":r,"text":n})),this.bdNode.one("a").on("click",function(){"phone"==this.type?i.goldlog("/wanle.10.5","","47700902"):"qq"==this.type?i.goldlog("/game.7.4.10","","H46777382"):"card"==this.type&&i.goldlog("/game.7.1.11","","H46777383")})},"printLoading":function(){this.tbrContainerNode.removeClass(l).addClass("tbr-loading"),this.resultNode.show(),this.buyBtnNode.show(),this.bdNode.html('<span class="tbr-loading">\u6b63\u5728\u67e5\u8be2...</span>')},"printError":function(){this.tbrContainerNode.removeClass(l).addClass("tbr-error"),this.buyBtnNode.show(),this.resultNode.hide()},"printPriceIntervals":function(e){this.tbrContainerNode.removeClass(l).addClass("tbr-initial"),this.buyBtnNode.show(),this.resultNode.show(),this.hdLabelNode&&this.hdLabelNode.html("\u552e\u4ef7"),"taobao"!=this.priceStyle?this.bdNode.html(t.substitute('<span class="tbr-price"><strong>{price1}</strong><span>{unit}</span>-<strong>{price2}</strong><span>{unit}</span></span>',{"unit":s,"price1":e[0],"price2":e[1]})):c()&&"phone"==this.type?(h("/wap.1001.5","47700902"),this.printPayChannel([e[0],e[0]-5])):(this.bdNode.parent(".tbr-block").removeClass("paychannel-block"),this.bdNode.html(t.substitute('<span class="tbr-price"><span>{unit}</span><strong>{price1}-{price2}</strong></span>',{"unit":a,"price1":e[0],"price2":e[1]})))},"printPayChannel":function(e){this.tbrContainerNode.removeClass(l).addClass("tbr-initial"),this.buyBtnNode.text("\u624b\u673a\u5145\u503c"),this.bdNode.parent(".tbr-block").addClass("paychannel-block"),this.bdNode.html(t.substitute(d,{"unit":a,"price1":e[0],"price2":e[1]}))},"getContainer":function(){return this.resultNode},"printThf":function(e){var n=e&&e.availableFee||0;if(t.isNumber(n)&&n>0){var r=this.resultNode,i=r.all(".j-box-thf"),o=i.all("strong"),a=t.namespace("tbr",t).phone.itemData;o.html((n/100).toFixed(2)),i.show(),a.isThfCheckboxVisible=!0}},"hideThf":function(){var e=this.resultNode,n=e.all(".j-box-thf"),r=t.namespace("tbr",t).phone.itemData;n.hide(),r.isThfCheckboxVisible=!1}}),u});KISSY.add("tbr/buy",["tbr/utils/monitor","util","base","node"],function(e,t,n,r){function i(t){t&&t.containerNode&&t.type||e.error("[buy]\u53c2\u6570\u9519\u8bef"),i.superclass.constructor.call(this),this._type=t.type,this._fastbuy=e.namespace("tbr",e).fastbuy||!1,e.log("[buy]\u8bbf\u5ba2: "+!!this._fastbuy),this._containerNode=t.containerNode,this._btnNode=this._containerNode.one(".tbr-btn-buy"),this._bindEvents(),this.clientSource="cun.taobao.com"==location.hostname?"TCC|cuntao":"TCC|tb_bmzx";var n=location.search.substr(1),r=e.unparam(n);r.clientSource&&(this.clientSource=r.clientSource)}var o=t("tbr/utils/monitor"),a=(t("util"),t("base")),s=t("node");return e.extend(i,a,{"_bindEvents":function(){var t=this;this._btnNode.on("click",function(n){n.preventDefault(),e.log("[buy]\u5145\u503c\u6309\u94ae\u88ab\u70b9\u51fb"),t.fire("click"),t._validate()?("card"==t._type?o.goldlog("/game.7.1.10","","H46777382"):"qq"==t._type&&o.goldlog("/game.7.4.9","","H46747621"),t.fire("submit",{"formNode":t._formNode})):e.log("[buy]\u9a8c\u8bc1\u5931\u8d25")}),this.on("afterDisabledChnage",function(e){e.newVal?t._btnNode.addClass("tbr-disabled"):t._btnNode.removeClass("tbr-disabled")})},"_validate":function(){var t=!1,n=e.namespace("tbr",e)[this._type].data,r=e.namespace("tbr",e)[this._type].itemData;return"phone"==this._type?(t=r.success&&r.itemId&&n.number,t&&(this._formNode=this._containerNode.one(".tbr-form-buy"),this._formNode.prop("phone").value=n.number,this._formNode.prop("item_id_num").value=r.itemId,this._formNode.prop("useTaohuafee").value=r.isThfCheckboxVisible&&r.useTaohuafee?1:0,this._formNode.prop("tccdetailc").value=this.clientSource)):"qq"==this._type?(t=r.success&&r.itemId&&n.number&&e.isString(r.skuId)&&""!=r.skuId,t&&(this._fastbuy&&"ecard"==r.itemType?this._formNode=this._containerNode.one(".tbr-form-fastbuy"):(this._formNode=this._containerNode.one(".tbr-form-buy"),this._formNode.prop("qqnum").value=n.number,this._formNode.prop("action").value=s.one(this._formNode.prop("action")).attr("data-"+r.itemType)),this._formNode.prop("item_id_num").value=r.itemId,this._formNode.prop("sku_id").value=r.skuId)):"card"==this._type&&(t=r.success&&r.itemId&&e.isString(r.skuId)&&""!=r.skuId,t&&(this._fastbuy&&"ecard"==r.itemType?this._formNode=this._containerNode.one(".tbr-form-fastbuy"):(this._formNode=this._containerNode.one(".tbr-form-buy"),"cardcode"==r.itemType?this._formNode.prop("action").value=s.one(this._formNode.prop("action")).attr("data-cardcode"):this._formNode.prop("action").value=""),this._formNode.prop("item_id_num").value=r.itemId,this._formNode.prop("sku_id").value=r.skuId)),e.log("[buy]validate result "+t),t},"submit":function(){var t=this;e.log("[buy]\u63d0\u4ea4\u8868\u5355"),this._formNode.getDOMNode().submit(),this.set("disabled",!0),e.later(function(){t.set("disabled",!1)},1e3)}},{"ATTRS":{"disabled":{"value":!0}}}),i});