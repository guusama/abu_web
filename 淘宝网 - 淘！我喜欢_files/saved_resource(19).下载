KISSY.add("tbr/config",["io"],function(t,e,n,r){var i=e("io"),o=/daily\.taobao\.net/.test(location.hostname),a=o?"tcc.daily.taobao.net":"tcc.taobao.com";return{"start":function(e,n,r){t.log("[config]start to config "+e),"phone"==e?this._startPhone(n):"qq"==e?this._startQQ(n):this._startCard(n),this._start(e,n,r)},"_start":function(e,n,r){var o=t.namespace("tbr",t),s=e;"fp"==n&&(o._startBasic||t.mix(o,{"priceStyle":"taobao","searchUrlBase":"//list.taobao.com/browse/browse/search_auction.htm?atype=b&commend=all&sort=bid&olu=yes&","numberHistory":{"max":5},"resultType":"general2","_startBasic":!0}),o._startData?(t.log("[config]completed with "+e),r&&r()):("card"!=e&&"qq"!=e||(s="game"),i({"url":t.substitute("//{hostname}/cc/json/loginInfo.htm?env={env}&type={type}",{"hostname":a,"env":"fp"==n?"fp_2012":n,"type":s}),"dataType":"jsonp","timeout":5,"cache":!1,"scriptCharset":"gbk","error":function(e,n){t.error("\u6570\u636e\u63a5\u53e3\u8bf7\u6c42\u51fa\u9519")},"success":function(n){var i=t.namespace("tbr",t);n&&n.success?(t.mix(i,{"fastbuy":n.isFastBuy,"loggedIn":n.hasLoggedIn,"isNew":(!window.SW_FRESHMAN||"off"!==window.SW_FRESHMAN)&&n.isNew,"phone":{"ad1":{"text":n.adtext,"href":n.adhref},"ad2":{"text":n.adtext2,"href":n.adhref2}}},void 0,void 0,!0),"game"==s&&(t.log("[config]read game data"),i._startData=!0,t.mix(i,{"card":{"skuDataList":n.card,"skuDataMap":{},"denomDataMap":{}}},void 0,void 0,!0),t.each(t.tbr.card.skuDataList,function(e){var n,r,i;t.tbr.card.skuDataMap[e.catId]=e,r=e.denomVId.split(","),n=e.denomText.split(","),i=e.denomFilter.split(";"),t.tbr.card.denomDataMap[e.catId]||(t.tbr.card.denomDataMap[e.catId]={}),t.each(r,function(r,o){t.tbr.card.denomDataMap[e.catId][r]={"text":n[o],"filter":i[o]}}),e.isDefault&&(t.tbr.card.defaultCatIdArr||(t.tbr.card.defaultCatIdArr=[]),t.tbr.card.defaultCatIdArr.push(e.catId))}),t.tbr.card.defaultCatIdArr.length>0&&(t.tbr.card.defaultCatId=t.tbr.card.defaultCatIdArr[Math.floor(Math.random()*t.tbr.card.defaultCatIdArr.length)]),t.mix(i,{"qq":{"skuDataList":n.qq,"skuDataMap":{},"denomDataMap":{}}},void 0,void 0,!0),t.each(t.tbr.qq.skuDataList,function(e){var n,r,i;t.tbr.qq.skuDataMap[e.catId]=e,r=e.denomVId.split(","),n=e.denomText.split(","),i=e.denomFilter.split(";"),t.tbr.qq.denomDataMap[e.catId]||(t.tbr.qq.denomDataMap[e.catId]={}),t.each(r,function(r,o){t.tbr.qq.denomDataMap[e.catId][r]={"text":n[o],"filter":i[o]}}),e.isDefault&&!t.tbr.qq.defaultCatId&&(t.tbr.qq.defaultCatId=e.catId)})),t.log("[config]completed with "+e),r&&r()):t.error("\u6570\u636e\u63a5\u53e3\u5f02\u5e38")}})))},"_startPhone":function(e){var n=t.namespace("tbr",t);"fp"==e&&t.mix(n,{"requestUrlBase":{"phone":"//"+a+"/cc/json/mobile_price.htm"},"phone":{"pmid":"1501042928119d6d9f31"}},void 0,void 0,!0)},"_startQQ":function(e){var n=t.namespace("tbr",t);"fp"==e&&t.mix(n,{"requestUrlBase":{"qq":"//"+a+"/cc/game_card_choose.htm"},"qq":{"pmid":"15005743000a9d9fe2a2"}},void 0,void 0,!0)},"_startCard":function(e){var n=t.namespace("tbr",t);"fp"==e&&t.mix(n,{"requestUrlBase":{"card":"//"+a+"/cc/json/game_card_price.htm"},"card":{"pmid":"15005742994f5cd3af3d"}},void 0,void 0,!0)}}});