/*! Generated by Clam: ntrip */
KISSY.add("ntrip/mods/ne/ne-form",["node","event","base","util","../common/trip-form","../common/trip-common"],function(a,b){function c(){var a=this;a.formNode=d.one("#J_ne_form"),a.type=d.all("#J_neType input"),a.depCity=d.one("#J_neDepCity"),a.arrCity=d.one("#J_neArrCity"),a.depTime=d.one("#J_neDepTime"),a.arrTime=d.one("#J_neArrTime"),a.icon=a.formNode.one(".J_tripGo"),a._init(),a._bindUI()}var d=b("node"),e=(b("event"),b("base")),f=b("util"),g=b("../common/trip-form"),h=b("../common/trip-common"),i=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,j={depCityNull:"\u8bf7\u9009\u62e9\u51fa\u53d1\u57ce\u5e02",arrCityNull:"\u8bf7\u9009\u62e9\u5230\u8fbe\u57ce\u5e02",sameCity:"\u51fa\u53d1\u57ce\u5e02\u548c\u5230\u8fbe\u57ce\u5e02\u4e0d\u80fd\u76f8\u540c",earlyThanToday:"\u51fa\u53d1\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u4eca\u5929",depTime:"\u8bf7\u9009\u62e9\u51fa\u53d1\u65e5\u671f",depTimeFormat:"\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",depOneYearLater:"\u51fa\u53d1\u65e5\u671f\u4e0d\u80fd\u4e3a\u4e00\u5e74\u4ee5\u540e",arrTime:"\u8bf7\u9009\u62e9\u8fd4\u7a0b\u65e5\u671f",arrTimeFormat:"\u65e5\u671f\u683c\u5f0f\u4e3a\uff1ayyyy-mm-dd",arrOneYearLater:"\u8fd4\u7a0b\u65e5\u671f\u4e0d\u80fd\u4e3a\u4e00\u5e74\u4ee5\u540e",depLaterArr:"\u8fd4\u7a0b\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u51fa\u53d1\u65e5\u671f",autoCompleteNull:'\u5bf9\u4e0d\u8d77\uff0c\u6ca1\u6709\u627e\u5230<span class="conve-error">"{userInput}"</span>'};return f.augment(c,e,{_init:function(){var b=this;b.formObj=new g({id:"#J_ne_form",calendar:[{id:"neCalendar",triggerNode:b.depTime,finalTriggerNode:b.arrTime,minDate:new Date,isDateIcon:!0,isHoliday:!0,isDateInfo:!1}],autoComplete:[{inputNode:"#J_neDepCity",hotSource:"//www.alitrip.com/go/rgn/trip/chinahotcity_jsonp.php",source:"//sjipiao.alitrip.com/city_search.do?lines=10&_input_charset=utf-8&q={query}",resultListLocator:"result",resultTextLocator:"cityName",wrapperClass:"conve-complete J_convePop",width:b.depCity.parent(".conve-input").outerWidth(),align:{node:b.depCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}},{inputNode:"#J_neArrCity",hotSource:"//www.alitrip.com/go/rgn/trip/chinahotcity_jsonp.php",source:"//sjipiao.alitrip.com/city_search.do?lines=10&_input_charset=utf-8&q={query}",resultListLocator:"result",resultTextLocator:"cityName",wrapperClass:"conve-complete J_convePop",width:b.arrCity.parent(".conve-input").outerWidth(),align:{node:b.arrCity.parent(".conve-input"),points:["br","tr"]},resultFormatter:function(b,c){return a.map(c,function(b){return a.substitute('<div class="ks-ac-item-inner"><span class="ks-ac-name">{cityname}</span></div>',{cityname:b.text})})}}]}),b.depCityAutoComplete=b.formObj.getAutoCompleteById("#J_neDepCity"),b.arrCityAutoComplete=b.formObj.getAutoCompleteById("#J_neArrCity"),b.calendar=b.formObj.getCalendarById("neCalendar"),a.each(b.type,function(a){var c=d.one(a);c.attr("checked")&&(b.typeVal=c.val(),b.changeType())})},_bindUI:function(){var a=this;a.formNode.on("submit",a.submitForm,a),a.type.on("click",a.changeType,a)},submitForm:function(){var a=this;a._validate()&&(a.formObj.storeFormInfo(),a.formNode.getDOMNode().submit())},changeType:function(b){var c=this;b&&(c.typeVal=d.one(b.currentTarget).val()),0==c.typeVal?(c.arrTime.val(""),c.arrTime.parent(".conve-input").hide(),c.calendar.set("endDate",""),c.calendar.set("selectedDate",a.trim(c.depTime.val())),c.calendar.render(),c.icon.removeClass("conve-trip-exchange")):(c.arrTime.parent(".conve-input").show(),c.icon.addClass("conve-trip-exchange"))},_validate:function(){var b=this,c=(new Date).setHours(0,0,0,0);if(!h.checkNull(b.depCity))return b.depCityAutoComplete.showMessage(j.depCityNull),!1;if(!h.checkNull(b.arrCity))return b.arrCityAutoComplete.showMessage(j.arrCityNull),!1;if(!h.isDiff(b.depCity,b.arrCity))return b.arrCityAutoComplete.showMessage(j.sameCity),!1;if(!h.checkNull(b.depTime))return b.calendar.set("message",j.depTime),b.calendar.showMessage(),!1;if(!h.checkFormat(b.depTime,i))return b.calendar.set("message",j.depTimeFormat),b.calendar.showMessage(),!1;var d=a.trim(b.depTime.val());if(h.parseDate(d)<c)return b.depTime.getDOMNode().focus(),b.calendar.set("message",j.earlyThanToday),b.calendar.showMessage(),!1;if(!h.isOneYearLater(d))return b.depTime.getDOMNode().focus(),b.calendar.set("message",j.depOneYearLater),b.calendar.showMessage(),!1;if(1==b.typeVal){if(!h.checkNull(b.arrTime))return b.calendar.set("message",j.arrTime),b.calendar.showMessage(),!1;if(!h.checkFormat(b.arrTime,i))return b.calendar.set("message",j.arrTimeFormat),b.calendar.showMessage(),!1;if(!h.isOneYearLater(a.trim(b.arrTime.val())))return b.arrTime.getDOMNode().focus(),b.calendar.set("message",j.arrOneYearLater),b.calendar.showMessage(),!1;if(h.getDays(a.trim(b.arrTime.val()),d)>0)return b.arrTime.getDOMNode().focus(),b.calendar.set("message",j.depLaterArr),b.calendar.showMessage(),!1}return!0}}),c});